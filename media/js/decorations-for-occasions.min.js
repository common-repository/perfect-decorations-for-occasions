var dfo=dfo||{};dfo.getSpinner=function(e){return jQuery('<p class="dfo-spinner-text"><i class="uk-icon-spinner uk-icon-spin"></i> '+e+" </p>")},dfo.spinner=function(e){return jQuery('<div class="dfo-spinner-m '+e+'"><svg class="circular"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg></div>')},dfo.serviceAPICall=function(e,t,a,o,n){jQuery.ajax({url:"https://www.perfect-web.co/index.php?option=com_dfo_service&task=api."+("undefined"!=typeof e?e:""),type:n||"POST",crossDomain:!0,jsonpCallback:"dfo_callback",cache:!1,data:"undefined"!=typeof t&&t?t:{},dataType:"jsonp"}).done(function(e){e&&"undefined"!=typeof e.success?e.success===!0?"function"==typeof a&&a.call(this,e):"function"==typeof o&&o.call(this,e):("function"==typeof o&&o.call(this,e),pwebCore.message("Connection with remote server has failed. Please try again.","danger",!0))}).fail(function(){"function"==typeof o&&o.call(this),pwebCore.message("Connection with remote server has failed. Please try again.","danger",!0)})},dfo.simpleAjaxCrossDomain=function(e,t,a,o,n,i,d){var s=this;jQuery.ajax({url:e,type:t||"POST",crossDomain:!0,timeout:5e3,jsonpCallback:i||"dfo_callback",cache:d||!1,data:"undefined"!=typeof a&&a?a:{},dataType:"jsonp"}).done(function(e){e?"function"==typeof o&&o.call(this,e):"function"==typeof n&&n.call(this)}).fail(function(){"function"==typeof n&&n.call(this),s.message("Connection with remote server has failed. Please try again.","danger",!0)})},dfo.message=function(e,t,a){switch("undefined"==typeof t&&(t=""),t){case"error":case"danger":t="danger";break;case"warning":t="warning";break;case"success":t="success";break;default:t=""}var o=jQuery("<div>",{"class":"uk-alert"+(t?" uk-alert-"+t:""),"data-uk-alert":"",html:'<a href="" class="uk-alert-close uk-close"></a><p>'+e+"</p>"}).css("display","none");"undefined"==typeof a&&(a="#perfect_messages"),jQuery(a).prepend(o),o.slideDown("slow",function(){setTimeout(function(){o.slideUp("slow",function(){jQuery(this).remove()})},5e3)})},dfo.calendarFilter=[];var simplecart=function(e){this.items=e||{},this.$element=null,this.total=0;var t=localStorage.getItem("dfo-cart");if(t){t=JSON.parse(t);for(var a in t)this.addItem(a,t[a].name,t[a].price,!0)}};simplecart.prototype.refresh=function(e){this.$element=jQuery(".dfo-cart"),Object.keys(this.items).length>0?(this.$element.fadeIn(),e||jQuery(".cart-items",this.$element).slideDown()):(e||jQuery(".cart-items",this.$element).slideUp(),this.$element.fadeOut()),jQuery(".cart-items li",this.$element).remove(),this.total=0;for(var t in this.items){var a=this.items[t];this.total=this.total+parseFloat(a.price),jQuery('<li data-id="'+t+'">'+a.name+" - &euro; "+a.price+'/mo<a href="#"><i class="uk-icon-trash-o uk-icon-hover"></i></a></li>').appendTo(".cart-items ul",this.$element)}jQuery('<li class="total">Total: <span class="price">&euro;'+this.total.toFixed(2)+'</span>/mo <span class="info">(exl. VAT, billed annually)</span></li>').appendTo(".cart-items ul",this.$element),jQuery(".cart-badge",this.$element).text(Object.keys(this.items).length),localStorage.setItem("dfo-cart",JSON.stringify(this.items))},simplecart.prototype.addItem=function(e,t,a,o){this.items[e]={name:t,price:a};var n=jQuery('[data-dfo-feed-id="'+e+'"] [data-dfo-buy-feed]');n.attr("disabled",!0),n.text("Already in your cart"),this.refresh(o)},simplecart.prototype.removeItem=function(e){this.items[e]&&(delete this.items[e],jQuery('[data-dfo-feed-id="'+e+'"] [data-dfo-buy-feed]').attr("disabled",!1),this.refresh())},simplecart.prototype.clearItems=function(){for(var e in this.items)this.removeItem(e)},dfo.cart=new simplecart,"true"===dfo.clear_cart&&dfo.cart.clearItems(),jQuery(document).ready(function(e){function t(e,i){var d=dfo.id_list[i].next;dfo.EventRender(o,n,d,t,a,!0)}function a(e,i){var d=dfo.id_list[i].prev;dfo.EventRender(o,n,d,t,a,!0)}if(dfo.EventRender=function(t,a,o,n,i){a&&a.show(),t.css({visibility:"hidden"}),pwebCore.ajax("action=perfect-decorations-for-occasions_eventDetails",{id:o},function(d){function s(){e(".dfo-demo-frame").css({height:Math.round(.5625*e(".dfo-demo-frame").width())})}t.html(d),t.css({visibility:"visible"}),"function"==typeof n&&e(".next",t).click(function(e){n(e,o)}),"function"==typeof i&&e(".prev",t).click(function(e){i(e,o)});for(var r in dfo.cart.items)e('[data-dfo-feed-id="'+r+'"] [data-dfo-buy-feed]').attr("disabled",!0);e(".dfo-slider").css({"min-height":Math.round(.5625*e(".dfo-demo-frame").width())}),s(),e(window).bind("resize",function(){s()}),a&&a.hide();var c=dfo.spinner("spinner-cover");c.appendTo(e(".dfo-slider")),e(".dfo-demo-frame").on("load",function(){c.hide(),e(this).velocity({opacity:[1,0]})})},function(){pwebCore.message("Failed to fetch event details. Try again later.","error"),a&&a.hide()},!1,!0,!0)},dfo.EventOpenTimeline=function(t){var a=UIkit.modal(".dfo-event-details");a.show();for(var o=e(".dfo-spinner",e(a.element)),n=e(".dfo-event",e(a.element)),i=0,d=0,s=e("#calendar").fullCalendar("clientEvents"),r=0;r<s.length;r++)if(s[r].id===t){r<s.length-1&&(i=s[r+1].id),r>0&&(d=s[r-1].id);break}dfo.EventRender(n,o,t,function(){0!==i&&dfo.EventOpenTimeline(i)},function(){0!==d&&dfo.EventOpenTimeline(d)})},e(".dfo-empty-db").length&&(e(".dfo-event-details").css({"min-height":.5625*e(".dfo-event-details").width()+"px"}),e(".dfo-demo-frame").on("load",function(){e(this).fadeIn(),e(this).css({height:.5625*e(".dfo-demo-frame").width()+"px"}),e(".dfo-spinner-text").hide()})),e("[data-dfo-autoload-event-id]").length){var o=e("[data-dfo-autoload-event-id]"),n=e(".dfo-spinner-text"),i=o.data("dfo-autoload-event-id");dfo.EventRender(o,n,i,t,a,!0)}if(e("#side-nav").dlmenu({animationClasses:{classin:"dl-animate-in-1",classout:"dl-animate-out-1"}}),e(".cart-toggler").click(function(){e(".cart-items").slideToggle()}),e(".cart-items").on("click","li>a",function(t){t.preventDefault();var a=e(this).parent().data("id");dfo.cart.removeItem(a)}),e("#wpbody").on("click","[data-dfo-buy-feed]",function(t){t.stopImmediatePropagation();var a=e(this).parent();dfo.cart.addItem(a.data("dfo-feed-id"),a.data("dfo-feed-name"),a.data("dfo-feed-price"))}),e("#wpbody").on("mouseenter","[data-dfo-buy-feed]",function(){e(this).data("dfo-on-mouseleave-text",e(this).text()),e(this).text("Add to cart")}),e("#wpbody").on("mouseleave","[data-dfo-buy-feed]",function(){e(this).text(e(this).data("dfo-on-mouseleave-text"))}),e("#checkout").click(function(){for(var e=Object.keys(dfo.cart.items),t="",a=0;a<e.length;a++)t=t+"&feed[]="+e[a];console.log(e.feed),console.log(t),window.open(dfo.cart_url+"&"+t,"_blank")}),e(".fake-btn").click(function(){e(this).attr("disabled",!0),e(".dfo-info").hide().text("Saved").fadeIn()}),e("#start_trial").click(function(t){t.preventDefault();var a=e("#referer input").val(),o=/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i;return a&&!o.test(a)?(e("#referer input").addClass("uk-form-danger"),void e("#referer .uk-form-help-inline").text("Please enter a valid e-mail address or leave blank").appendTo(e("#referer"))):(e(".dfo-content").velocity("fadeOut",{duration:750}),e(".dfo-activating").velocity("fadeIn",{duration:750}),void pwebCore.ajax("action=perfect-decorations-for-occasions_startTrial",{referer:a},function(){e(".dfo-cover").remove(),pwebCore.message("Your trial was activated. Have fun!","success")},function(){pwebCore.message("Failed to enable the trial. Please contact support","error")},!1,!0,!0))}),e(".dfo-cover").length&&e(".dfo-cover").css({bottom:"-"+e("#wpfooter").outerHeight()+"px"}),e("#referer_toggle").toggle(function(t){t.preventDefault(),e("#referer").velocity("slideDown",{duration:750}).velocity("fadeIn",{duration:1e3,queue:!1})},function(t){t.preventDefault(),e("#referer").velocity("slideUp",{duration:750}).velocity("fadeOut",{duration:1e3,queue:!1})}),e("#calendar").fullCalendar({eventSources:[{url:"admin-ajax.php?action=perfect-decorations-for-occasions_eventsTimeline",type:"POST",data:{filter:dfo.calendarFilter}}],buttonText:{today:"Go to current month"},aspectRatio:2,height:"auto",eventClick:function(e){dfo.EventOpenTimeline(e.id)}}),e("[data-dfo-feeds-filter]").length){var d=e("[data-dfo-feeds-filter]");d.detach().prependTo(".fc-toolbar .fc-right"),d.show(),d.chosen({width:"400px"}),d.on("change",function(t,a){if(a.selected&&dfo.calendarFilter.push(a.selected),a.deselected){var o=dfo.calendarFilter.indexOf(a.deselected);dfo.calendarFilter.splice(o,1)}e("#calendar").fullCalendar("refetchEvents")})}e(".dfo-force-sync").click(function(){var t=dfo.getSpinner("Downloading data from the service, please wait...");e(this).attr("disabled",!0),e(this).after(t);var a=e(this);pwebCore.ajax("action=perfect-decorations-for-occasions_forceServiceSync",{},function(){pwebCore.message("Data was downloaded from the service","success"),a.attr("disabled",!1),t.remove()},function(){pwebCore.message("There was a problem while fetching data from the service. Please try again later.","danger"),a.attr("disabled",!1),t.remove()},!1,!0,!0)}),e(".dfo-event-details").on("mouseenter",".dfo-slider",function(){e(".dfo-slider-controls-cover",e(this)).stop().fadeIn()}),e(".dfo-event-details").on("mouseleave",".dfo-slider",function(){e(".dfo-slider-controls-cover",e(this)).stop().fadeOut()}),e(".dfo-event-details").on("click",".vote",function(t){t.preventDefault();var a=e(this),o=null,n=e(this).parent().parent().data("dfo-decoration-id");o=a.hasClass("upvote")?1:2,e(".vote").removeClass("selected"),a.addClass("selected"),dfo.serviceAPICall("vote",{id:n,vote:o},function(t){"undefined"!=typeof t.data.upvotes&&(e(".upvote span").text(t.data.upvotes),e(".downvote span").text(t.data.downvotes),pwebCore.ajax("action=perfect-decorations-for-occasions_updateVotes",{id:n,up:t.data.upvotes,down:t.data.downvotes,vote:o},!1,!1,!1,!0,!0))},function(){})}),e(".dfo-event-details").on("click","[data-dfo-publish-toggler]",function(){var t=e(this),a=t.data("dfo-event-id");t.attr("disabled",!0),pwebCore.ajax("action=perfect-decorations-for-occasions_eventOverride",{id:a,toggle:"true"},function(){dfo.message("Event status changed","success",".dfo-event-messages"),t.attr("disabled",!1);var a=t.text();t.text(t.data("dfo-ontoggle")),t.data("dfo-ontoggle",a),e("#calendar").fullCalendar("refetchEvents")},function(){dfo.message("Couldn't toggle the event. Please try again later.","danger",".dfo-event-messages"),t.attr("disabled",!1)},!1,!0,!0)}),e(".dfo-event-details").on("click","[data-dfo-reschedule]",function(){var t=e(this),a=t.data("dfo-event-id"),o=e("#dateStart").val(),n=e("#dateEnd").val();t.attr("disabled",!0),pwebCore.ajax("action=perfect-decorations-for-occasions_eventOverride",{id:a,date_start:o,date_end:n},function(){dfo.message("Event rescheduled","success",".dfo-event-messages"),t.attr("disabled",!1),e("#calendar").fullCalendar("refetchEvents")},function(e){dfo.message(e||"Unknown error","danger",".dfo-event-messages"),t.attr("disabled",!1)},!1,!0,!0)}),e(".dfo-event-details").on("click",".dfo-clear-cache",function(){var t=e(".dfo-demo-frame"),a=t.attr("src")+"&force=1";t.velocity({opacity:[0,1]},{complete:function(){e(".dfo-spinner-m").show()}}),e(".dfo-demo-frame").attr("src",a)}),e(".dfo-event-details").on("click","[data-dfo-reset]",function(){var t=e(this),a=t.data("dfo-event-id");t.attr("disabled",!0),pwebCore.ajax("action=perfect-decorations-for-occasions_eventReset",{id:a},function(a){dfo.message("Event has been reset to its defaults","success",".dfo-event-messages"),t.attr("disabled",!1),e("#calendar").fullCalendar("refetchEvents"),e("#dateStart").val(a.date_start),e("#dateEnd").val(a.date_end)},function(){t.attr("disabled",!1)},!1,!0,!0)}),e(".advanced_text").length>0&&e(".advanced_text").detach().appendTo("fieldset.advanced"),e(".dfo-toggle-advanced").click(function(t){t.preventDefault(),e("fieldset.advanced").slideToggle()})});
