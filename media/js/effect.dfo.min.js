var DFO=DFO||{};!function(e){"use strict";DFO.Effect=function(t,i){function o(){n.img=document.createElement("img"),n.img.onload=function(){n.imgHeight=this.naturalHeight,n.imgWidth=this.naturalWidth,n.options.autoScale&&(a(),e(window).bind("resize",function(){s(),a()}))},n.img.className="perfect-decoration",n.img.src=n.options.sourceIsBase64?"data:image/"+n.options.sourceBase64MIME+";base64,"+n.options.source:n.options.source,n.$img=e(n.img)}function a(){n.$img.css({height:n.imgHeight*n.scale+"px",width:n.imgWidth*n.scale+"px"})}function s(){n.scale=n.options.autoScale?Math.min(n.$sizer.width()/1600,1):1}var n=this;this.$container=t;var r={};"string"==typeof i?r=JSON.parse(i):"object"==typeof i&&(r=i),this.uid="dfo-"+Math.floor(1+65536*Math.random()).toString(16);var c={source:"",sourceIsBase64:!1,sourceBase64MIME:"png",autoScale:!0,type:"",position:"right-bottom",flake_position:"fixed",sizer:"",ignoreTouch:!1};switch(this.options=e.extend({},c,r),this.$sizer=this.options.sizer?e(this.options.sizer):this.$container,s(),this.options.type){case"cursor":case"mouse-follower":case"1":case 1:this.options.type="mouse-follower";break;case"glued":case"repeated":case"fixed-image":case"2":case 2:this.options.type="fixed-image";break;case"falling-images":case"falling":case"flakes":case"3":case 3:this.options.type="falling-images";break;case"custom-js":case"4":case 4:this.options.type="custom-js";break;case"custom-css":case"5":case 5:this.options.type="custom-css";break;default:this.options.type=""}this.options.type&&"custom-js"!==this.options.type&&"custom-css"!==this.options.type&&o()},DFO.Effect.prototype.renderMouseFollower=function(){var t=this;(!Modernizr.touch||t.options.ignoreTouch)&&(e(document).on("mousemove.dfo."+t.uid,function(i){var o,a=0,s=e(document).width()-t.imgWidth*t.scale,n=e(document).height()-t.imgHeight*t.scale;switch(t.options.position){case"left-top":o=i.pageX-t.imgWidth*t.scale-8,a=i.pageY-t.imgHeight*t.scale-8;break;case"left-bottom":o=i.pageX-t.imgWidth*t.scale-8,a=i.pageY+8;break;case"right-top":o=i.pageX+8,a=i.pageY-t.imgHeight*t.scale-8;break;case"right-bottom":default:o=i.pageX+8,a=i.pageY+8}t.$img.offset({left:Math.min(o,s),top:Math.min(a,n)})}),t.$img.addClass("perfect-decorations-cursor"),t.$container.append(t.$img))},DFO.Effect.prototype.hideMouseFollower=function(){e(document).off("mousemove.dfo."+this.uid),this.$img.remove()},DFO.Effect.prototype.renderFixedImage=function(){var t=this;t.options.repeated?(t.$div=e("<div />",{"class":"perfect-decorations-glued perfect-decoration repeat"}),t.$div.css({"background-image":"url("+t.img.src+")",height:Math.round(t.imgHeight*t.scale)+"px"}),t.$div.addClass(t.options.position),t.$container.append(t.$div),e(window).on("resize",function(){t.$div.css({height:Math.round(t.imgHeight*t.scale)+"px"})}),t.$img.on("load",function(){t.$div.css({height:Math.round(t.imgHeight*t.scale)+"px"})})):(("left-middle"===t.options.position||"right-middle"===t.options.position)&&t.$img.css({"margin-top":-(t.imgHeight*t.scale)/2}),t.$img.addClass(t.options.position),t.$img.addClass("perfect-decorations-glued"),t.$container.append(t.$img))},DFO.Effect.prototype.hideFixedImage=function(){this.options.repeated?this.$div.remove():this.$img.remove()},DFO.Effect.prototype.renderFallingImages=function(){function t(){var e=document.createElement("div");e.setAttribute("class","perfect-decoration-flake-holder"),document.body.appendChild(e);for(var t=7e3/u.options.spawnInterval,i=0;t>i;i++)e.appendChild(n())}function i(e,t){return e+Math.floor(Math.random()*(t-e))}function o(e,t){return e+Math.random()*(t-e)}function a(e){return e+"%"}function s(e){return e+"s"}function n(){var t=document.createElement("div"),n=document.createElement("img");n.src=u.$img.attr("src"),u.scale=u.options.autoScale?Math.min(u.$sizer.width()/1600,1):1,e(n).load(function(){n.style.width=u.scale>=1?n.naturalWidth+"px":n.naturalWidth*u.scale*1.4+"px"}),e(window).resize(function(){u.scale=u.options.autoScale?Math.min(u.$sizer.width()/1600,1):1,n.style.width=u.scale>=1?n.naturalWidth+"px":n.naturalWidth*u.scale*1.4+"px"}),t.setAttribute("class","perfect-decorations-flake-2"),t.style.top="-10%",t.style.left=a(i(0,100));var r=Math.random()<.5?"clockwiseSpin":"counterclockwiseSpinAndFlip";t.style.webkitAnimationName="fade, drop",t.style.mozAnimationName="fade, drop",t.style.oAnimationName="fade, drop",t.style.msAnimationName="fade, drop",t.style.animationName="fade, drop",n.style.webkitAnimationName=r,n.style.mozAnimationName=r,n.style.oAnimationName=r,n.style.msAnimationName=r,n.style.animationName=r;var c=s(o(5,11)),m=s(o(4,8));t.style.webkitAnimationDuration=c+", "+c,t.style.mozAnimationDuration=c+", "+c,t.style.oAnimationDuration=c+", "+c,t.style.msAnimationDuration=c+", "+c,t.style.animationDuration=c+", "+c;var d=s(o(0,5));return t.style.webkitAnimationDelay=d+", "+d,t.style.mozAnimationDelay=d+", "+d,t.style.oAnimationDelay=d+", "+d,t.style.msAnimationDelay=d+", "+d,t.style.animationDelay=d+", "+d,n.style.webkitAnimationDuration=m,n.style.mozAnimationDuration=m,n.style.oAnimationDuration=m,n.style.msAnimationDuration=m,n.style.animationDuration=m,t.appendChild(n),t}var r=!1,c="animation",m="",d="",p=["Webkit","Moz","O","ms","Khtml"],l=document.body.style,u=this;u.options.accelerationRandomizer=parseInt(u.options.accelerationRandomizer)||10,u.options.wander=parseInt(u.options.wander)||100,u.options.spawnInterval=parseInt(u.options.spawnInterval)||750;for(var f=0;f<p.length;f++)if(void 0!==l[p[f]+"AnimationName"]){d=p[f],c=d+"Animation",m="-"+d.toLowerCase()+"-",r=!0;break}r!==!1&&jQuery(document).ready(function(){t()})},DFO.Effect.prototype.hideFallingImages=function(){e(".perfect-decoration-flake-holder").remove()},DFO.Effect.prototype.renderCustomJS=function(){e.ajax({url:this.options.source,dataType:"script",success:function(){window.CustomEffectRun()},async:!0})},DFO.Effect.prototype.hideCustomJS=function(){window.CustomEffectStop()},DFO.Effect.prototype.renderCustomCSS=function(){var t=this;e.ajax({url:t.options.source,dataType:"text",success:function(i){e('<style type="text/css" data-id="'+t.uid+'">\n'+i+"</style>").appendTo("head")}})},DFO.Effect.prototype.hideCustomCSS=function(){e('[data-id="'+this.uid+'"]').remove()},DFO.Effect.prototype.start=function(){var e=this;switch(e.options.type){case"mouse-follower":e.renderMouseFollower();break;case"fixed-image":e.renderFixedImage();break;case"falling-images":e.renderFallingImages();break;case"custom-js":e.renderCustomJS();break;case"custom-css":e.renderCustomCSS()}},DFO.Effect.prototype.stop=function(){var e=this;switch(e.options.type){case"mouse-follower":e.hideMouseFollower();break;case"fixed-image":e.hideFixedImage();break;case"falling-images":e.hideFallingImages();break;case"custom-js":e.hideCustomJS();break;case"custom-css":e.hideCustomCSS()}}}(jQuery);
